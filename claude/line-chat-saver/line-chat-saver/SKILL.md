---
name: line-chat-saver
description: LINE Mac版デスクトップアプリの個人チャット（トーク履歴）をテキストファイルとして自動保存するスキル。AppleScriptを使ってLINEアプリのUI操作を自動化し、指定した相手とのトーク履歴を.txtファイルとしてエクスポートする。「LINEのチャットを保存」「LINEのトーク履歴をバックアップ」「LINE会話をテキストで出力」など、LINEに関するチャット保存・エクスポート・バックアップの依頼があったときに使用する。
---

# LINE Chat Saver

## 概要

LINE Mac版デスクトップアプリ（jp.naver.line.mac）のトーク履歴を、AppleScriptによるUI自動化で.txtファイルとして保存するスキル。ユーザーが指定した相手名のチャットを自動的に開き、トーク履歴のエクスポート機能を使ってテキストファイルとして保存する。

## 前提条件

- macOS環境であること
- LINE Mac版デスクトップアプリがインストール・ログイン済みであること
- 「システム設定 > プライバシーとセキュリティ > アクセシビリティ」でスクリプト実行環境（Terminal、Ghostty等）にアクセス許可が付与されていること
- LINEアプリが起動していること

## ワークフロー

### ステップ1: ユーザーから情報を取得

以下をユーザーに確認する：
- **保存したい相手の名前**（LINE上の表示名）
- **保存先のフォルダパス**（デフォルト: ~/Documents/LINE_chats/）

### ステップ2: AppleScriptを実行

`scripts/save_line_chat.scpt` を使ってLINEアプリを操作する。

スクリプトの実行方法：
```bash
osascript scripts/save_line_chat.scpt "相手の名前" "/保存先/パス"
```

### ステップ3: 操作の流れ

AppleScriptは以下の順序でLINEアプリを操作する：

1. **LINEアプリをアクティブにする** - `tell application "LINE" to activate`
2. **チャットリストで相手を検索する** - 検索フィールドに相手名を入力
3. **対象チャットを選択する** - 検索結果から相手のチャットをクリック
4. **トーク履歴の保存メニューを開く** - メニューバーから「ファイル > トーク履歴を保存」、もしくはチャット設定メニューから操作
5. **保存ダイアログで保存先を指定する** - 保存先パスを入力
6. **「保存」ボタンをクリックする** - ファイルを保存

### ステップ4: 結果を確認

保存が完了したら、出力ファイルの存在を確認する：
```bash
ls -la "/保存先/パス/"
```

## トラブルシューティング

### よくある問題

**アクセシビリティ権限エラー:**
AppleScriptがUI操作できない場合、アクセシビリティ権限を確認する。
```bash
# ターミナルにアクセシビリティ権限があるか確認
osascript -e 'tell application "System Events" to get name of first process'
```

**LINEが起動していない:**
スクリプト実行前にLINEアプリを起動しておく必要がある。
```bash
open -a LINE
sleep 3
```

**チャット相手が見つからない:**
LINE上の表示名と完全に一致する名前を指定する必要がある。ひらがな・カタカナ・漢字の違いに注意。

**保存ダイアログの言語:**
スクリプトは日本語環境のLINEを前提としている。英語環境の場合はスクリプト内のUI要素名を調整する必要がある。

## リソース

### scripts/
- `save_line_chat.scpt` - メインのAppleScript。LINEアプリを操作してトーク履歴を保存する
- `save_line_chat.sh` - シェルスクリプトラッパー。引数チェックや保存先ディレクトリの作成を行い、AppleScriptを呼び出す

### references/
- `line_ui_structure.md` - LINE Mac版のUI構造とアクセシビリティ要素の情報（クリックログから抽出）
